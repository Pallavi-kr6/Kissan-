import { createContext, useContext, useEffect, useMemo, useState } from 'react';

const I18nContext = createContext({ t: (k) => k, lang: 'en', setLang: () => {} });

const DICTS = {
  en: {
    app_title: 'Kissan+',
    nav_home: 'Home',
    nav_subsidy: 'Subsidy',
    nav_schemes: 'Schemes',
    nav_disease: 'Disease',
    schemes_hero_title: 'Government Schemes for Farmers',
    schemes_hero_sub: 'Explore key schemes that support income, credit, insurance, markets and infrastructure. Click a card to learn more.',
    learn_more: 'Learn more',
    // Home
    home_title: 'Welcome to Kissan+',
    home_sub: 'A simple assistant for farmers to find subsidies, latest schemes, and detect crop diseases.',
    home_b1: 'Check region-wise subsidy and mandi prices',
    home_b2: 'Browse latest government schemes',
    home_b3: 'Detect plant diseases from leaf images',
    // Subsidy
    subsidy_title: 'Subsidy & Prices',
    subsidy_label_state: 'Select State',
    subsidy_label_commodity: 'Enter Crop Name',
    subsidy_placeholder_commodity: 'e.g. Tomato',
    subsidy_cta: 'Fetch Subsidy Prices',
    subsidy_fetching: 'Fetching data...',
    subsidy_error: 'Failed to fetch data.',
    subsidy_modal_price: 'Modal Price:',
    subsidy_min_price: 'Min Price:',
    subsidy_max_price: 'Max Price:',
    subsidy_arrival_date: 'Arrival Date:',
    subsidy_state: 'State:',
    subsidy_variety: 'Variety:',
    // Disease
    disease_title: 'Disease Detection',
    disease_upload_label: 'Upload Leaf Image',
    disease_cta: 'Detect Disease',
    disease_analyzing: 'Analyzing image...',
    disease_err_upload: 'Please upload an image first.',
    disease_err_fail: 'Failed to detect disease.',
    disease_result_title: 'Diagnosis Result',
    disease_result_disease: 'Disease:',
    disease_result_suggestion: 'Suggestion:',
    // Generic
    loading: 'Loading...',
    // Calculator
    calc_title: 'Profit & Cost Calculator',
    calc_land_size: 'Land Size (acres)',
    calc_fertilizer_cost: 'Fertilizer Cost (₹/acre)',
    calc_seed_cost: 'Seed Cost (₹/acre)',
    calc_labour_cost: 'Labour Cost (₹/acre)',
    calc_selling_price: 'Selling Price (₹/quintal)',
    calc_yield: 'Expected Yield (quintals/acre)',
    calc_button: 'Calculate',
    calc_reset: 'Reset',
    calc_total_cost: 'Total Cost',
    calc_total_revenue: 'Total Revenue',
    calc_net_profit: 'Net Profit',
    calc_profit_msg: "You'll make {amount} profit per acre",
    calc_loss_msg: 'You may incur {amount} loss per acre',
    calc_error: 'Failed to calculate.',
    // Nearby Services
    nearby_title: 'Nearby Services',
    nearby_button: 'Find Nearby Services',
    nearby_locating: 'Locating…',
    nearby_error_location: 'Failed to get location',
    nearby_error_permission: 'Permission denied or unavailable',
    nearby_error_load: 'Failed to load services',
    nearby_no_results: 'No services found nearby',
    // Expert Chat
    expert_name: 'Expert',
    expert_greeting: 'Hi, I am Expert. Ask me anything about crops, prices or this app.',
    expert_placeholder: 'Ask Expert…',
    expert_send: 'Send',
    expert_thinking: 'Thinking…',
    expert_error: 'Error: unable to answer right now.',
    expert_error_ask: 'Sorry, I could not find an answer.',
  },
  hi: {
    app_title: 'किसान+',
    nav_home: 'होम',
    nav_subsidy: 'सब्सिडी',
    nav_schemes: 'योजनाएँ',
    nav_disease: 'रोग',
    schemes_hero_title: 'किसानों के लिए सरकारी योजनाएँ',
    schemes_hero_sub: 'आय, ऋण, बीमा, बाजार और इंफ्रास्ट्रक्चर के लिए प्रमुख योजनाएँ देखें। अधिक जानने के लिए कार्ड पर क्लिक करें।',
    learn_more: 'और जानें',
    home_title: 'किसान+ में आपका स्वागत है',
    home_sub: 'सब्सिडी, नवीनतम योजनाएँ और पौधों के रोग पहचानने के लिए एक सरल सहायक।',
    home_b1: 'क्षेत्रवार सब्सिडी और मंडी भाव देखें',
    home_b2: 'नवीनतम सरकारी योजनाएँ ब्राउज़ करें',
    home_b3: 'पत्तियों की छवियों से रोग पहचानें',
    subsidy_title: 'सब्सिडी और कीमतें',
    subsidy_label_state: 'राज्य चुनें',
    subsidy_label_commodity: 'फसल का नाम दर्ज करें',
    subsidy_placeholder_commodity: 'जैसे टमाटर',
    subsidy_cta: 'सब्सिडी कीमतें प्राप्त करें',
    subsidy_fetching: 'डेटा प्राप्त किया जा रहा है...',
    subsidy_error: 'डेटा प्राप्त करने में विफल।',
    subsidy_modal_price: 'मोडल कीमत:',
    subsidy_min_price: 'न्यूनतम कीमत:',
    subsidy_max_price: 'अधिकतम कीमत:',
    subsidy_arrival_date: 'आगमन तिथि:',
    subsidy_state: 'राज्य:',
    subsidy_variety: 'किस्म:',
    disease_title: 'रोग पहचान',
    disease_upload_label: 'पत्ती की छवि अपलोड करें',
    disease_cta: 'रोग पहचानें',
    disease_analyzing: 'छवि का विश्लेषण हो रहा है...',
    disease_err_upload: 'कृपया पहले एक छवि अपलोड करें।',
    disease_err_fail: 'रोग पहचानने में विफल।',
    disease_result_title: 'निदान परिणाम',
    disease_result_disease: 'रोग:',
    disease_result_suggestion: 'सुझाव:',
    loading: 'लोड हो रहा है...',
    calc_title: 'लाभ और लागत कैलकुलेटर',
    calc_land_size: 'भूमि का आकार (एकड़)',
    calc_fertilizer_cost: 'उर्वरक लागत (₹/एकड़)',
    calc_seed_cost: 'बीज लागत (₹/एकड़)',
    calc_labour_cost: 'श्रम लागत (₹/एकड़)',
    calc_selling_price: 'विक्रय मूल्य (₹/क्विंटल)',
    calc_yield: 'अपेक्षित उपज (क्विंटल/एकड़)',
    calc_button: 'गणना करें',
    calc_reset: 'रीसेट',
    calc_total_cost: 'कुल लागत',
    calc_total_revenue: 'कुल राजस्व',
    calc_net_profit: 'शुद्ध लाभ',
    calc_profit_msg: 'आपको प्रति एकड़ {amount} लाभ होगा',
    calc_loss_msg: 'आपको प्रति एकड़ {amount} की हानि हो सकती है',
    calc_error: 'गणना करने में विफल।',
    nearby_title: 'निकटवर्ती सेवाएं',
    nearby_button: 'निकटवर्ती सेवाएं खोजें',
    nearby_locating: 'स्थान ज्ञात किया जा रहा है...',
    nearby_error_location: 'स्थान प्राप्त करने में विफल',
    nearby_error_permission: 'अनुमति अस्वीकृत या अनुपलब्ध',
    nearby_error_load: 'सेवाएं लोड करने में विफल',
    nearby_no_results: 'कोई सेवाएं नहीं मिलीं',
    expert_name: 'विशेषज्ञ',
    expert_greeting: 'नमस्ते, मैं विशेषज्ञ हूं। फसल, कीमतों या इस ऐप के बारे में कुछ भी पूछें।',
    expert_placeholder: 'विशेषज्ञ से पूछें...',
    expert_send: 'भेजें',
    expert_thinking: 'सोच रहा हूं...',
    expert_error: 'त्रुटि: अभी उत्तर देने में असमर्थ।',
    expert_error_ask: 'क्षमा करें, मुझे उत्तर नहीं मिला।',
  },
  mr: {
    app_title: 'किसान+',
    nav_home: 'मुख्यपृष्ठ',
    nav_subsidy: 'अनुदान',
    nav_schemes: 'योजना',
    nav_disease: 'रोग',
    schemes_hero_title: 'शेतकऱ्यांसाठी सरकारी योजना',
    schemes_hero_sub: 'उत्पन्न, कर्ज, विमा, बाजार आणि पायाभूत सुविधांसाठी प्रमुख योजना पहा. अधिक जाणून घेण्यासाठी कार्डवर क्लिक करा.',
    learn_more: 'अधिक जाणून घ्या',
    home_title: 'किसान+ मध्ये स्वागत आहे',
    home_sub: 'अनुदान, ताज्या योजना आणि पिकरोग ओळखण्यासाठी एक सोपा सहाय्यक.',
    home_b1: 'प्रदेशनिहाय अनुदान आणि बाजारभाव पहा',
    home_b2: 'ताज्या सरकारी योजना ब्राउझ करा',
    home_b3: 'पानांच्या प्रतिमांवरून रोग ओळखा',
    subsidy_title: 'अनुदान व किंमती',
    subsidy_label_state: 'राज्य निवडा',
    subsidy_label_commodity: 'पीकाचे नाव लिहा',
    subsidy_placeholder_commodity: 'उदा. टोमॅटो',
    subsidy_cta: 'अनुदान किंमती मिळवा',
    subsidy_fetching: 'माहिती आणली जात आहे...',
    subsidy_error: 'माहिती आणण्यात अयशस्वी.',
    subsidy_modal_price: 'मोडल किंमत:',
    subsidy_min_price: 'किमान किंमत:',
    subsidy_max_price: 'कमाल किंमत:',
    subsidy_arrival_date: 'आगमन तारीख:',
    subsidy_state: 'राज्य:',
    subsidy_variety: 'जाती:',
    disease_title: 'रोग ओळख',
    disease_upload_label: 'पानाची प्रतिमा अपलोड करा',
    disease_cta: 'रोग ओळखा',
    disease_analyzing: 'प्रतिमा विश्लेषित होत आहे...',
    disease_err_upload: 'कृपया आधी प्रतिमा अपलोड करा.',
    disease_err_fail: 'रोग ओळखण्यात अयशस्वी.',
    disease_result_title: 'निदान निकाल',
    disease_result_disease: 'रोग:',
    disease_result_suggestion: 'सूचना:',
    loading: 'लोड होत आहे...',
    calc_title: 'नफा आणि खर्च कॅल्क्युलेटर',
    calc_land_size: 'जमिनीचा आकार (एकर)',
    calc_fertilizer_cost: 'खत खर्च (₹/एकर)',
    calc_seed_cost: 'बियाणे खर्च (₹/एकर)',
    calc_labour_cost: 'श्रम खर्च (₹/एकर)',
    calc_selling_price: 'विक्री किंमत (₹/क्विंटल)',
    calc_yield: 'अपेक्षित उत्पन्न (क्विंटल/एकर)',
    calc_button: 'गणना करा',
    calc_reset: 'रीसेट',
    calc_total_cost: 'एकूण खर्च',
    calc_total_revenue: 'एकूण महसूल',
    calc_net_profit: 'निव्वळ नफा',
    calc_profit_msg: 'तुम्हाला प्रती एकर {amount} नफा होईल',
    calc_loss_msg: 'तुम्हाला प्रती एकर {amount} तोटा होऊ शकतो',
    calc_error: 'गणना करण्यात अयशस्वी.',
    nearby_title: 'जवळच्या सेवा',
    nearby_button: 'जवळच्या सेवा शोधा',
    nearby_locating: 'स्थान शोधले जात आहे...',
    nearby_error_location: 'स्थान मिळविण्यात अयशस्वी',
    nearby_error_permission: 'परवानगी नाकारली किंवा अनुपलब्ध',
    nearby_error_load: 'सेवा लोड करण्यात अयशस्वी',
    nearby_no_results: 'कोणत्याही सेवा सापडल्या नाहीत',
    expert_name: 'तज्ञ',
    expert_greeting: 'नमस्कार, मी तज्ञ आहे. पिके, किंमती किंवा या अॅप बद्दल काहीही विचारा.',
    expert_placeholder: 'तज्ञांना विचारा...',
    expert_send: 'पाठवा',
    expert_thinking: 'विचार करत आहे...',
    expert_error: 'त्रुटी: आत्ता उत्तर देऊ शकत नाही.',
    expert_error_ask: 'माफ करा, मला उत्तर सापडले नाही.',
  },
  ta: {
    app_title: 'கிசான்+',
    nav_home: 'முகப்பு',
    nav_subsidy: 'உதவித்தொகை',
    nav_schemes: 'திட்டங்கள்',
    nav_disease: 'நோய்',
    schemes_hero_title: 'விவசாயிகளுக்கான அரசு திட்டங்கள்',
    schemes_hero_sub: 'வருமானம், கடன், காப்பீடு, சந்தை மற்றும் அடிப்படை வசதிகளுக்கான முக்கிய திட்டங்களை காணவும். மேலும் அறிய அட்டையை கிளிக் செய்யவும்.',
    learn_more: 'மேலும் அறிய',
    home_title: 'கிசான்+ வரவேற்கிறது',
    home_sub: 'உதவித்தொகை, சமீபத்திய திட்டங்கள் மற்றும் பயிர் நோய் கண்டறிதல் ஆகியவற்றிற்கான எளிய உதவியாளர்.',
    home_b1: 'பிராந்திய வாரியான உதவித்தொகை மற்றும் மண்டி விலை',
    home_b2: 'சமீபத்திய அரசு திட்டங்களை உலாவவும்',
    home_b3: 'இலை படங்களிலிருந்து நோய்களை கண்டறியவும்',
    subsidy_title: 'உதவித்தொகை & விலை',
    subsidy_label_state: 'மாநிலத்தைத் தேர்வு செய்க',
    subsidy_label_commodity: 'பயிர் பெயரை உள்ளிடுக',
    subsidy_placeholder_commodity: 'எ.கா. தக்காளி',
    subsidy_cta: 'உதவித்தொகை விலைகளை பெற',
    subsidy_fetching: 'தரவு பெறப்படுகிறது...',
    subsidy_error: 'தரவை பெற முடியவில்லை.',
    subsidy_modal_price: 'மாடல் விலை:',
    subsidy_min_price: 'குறைந்த விலை:',
    subsidy_max_price: 'அதிகபட்ச விலை:',
    subsidy_arrival_date: 'வருகை தேதி:',
    subsidy_state: 'மாநிலை:',
    subsidy_variety: 'வகை:',
    disease_title: 'நோய் கண்டறிதல்',
    disease_upload_label: 'இலையின் படத்தை பதிவேற்றவும்',
    disease_cta: 'நோயை கண்டறி',
    disease_analyzing: 'படம் பகுப்பாய்வு செய்யப்படுகிறது...',
    disease_err_upload: 'முதல் படத்தை பதிவேற்றவும்.',
    disease_err_fail: 'நோயை கண்டறிய இயலவில்லை.',
    disease_result_title: 'ஆய்வு முடிவு',
    disease_result_disease: 'நோய்:',
    disease_result_suggestion: 'பரிந்துரை:',
    loading: 'ஏற்றப்படுகிறது...',
    calc_title: 'லாபம் & செலவு கணக்கிடுபவர்',
    calc_land_size: 'நில அளவு (ஏக்கர்)',
    calc_fertilizer_cost: 'உர செலவு (₹/ஏக்கர்)',
    calc_seed_cost: 'விதை செலவு (₹/ஏக்கர்)',
    calc_labour_cost: 'தொழிலாளர் செலவு (₹/ஏக்கர்)',
    calc_selling_price: 'விற்பனை விலை (₹/குவின்டால்)',
    calc_yield: 'எதிர்பார்க்கப்படும் விளைச்சல் (குவின்டால்/ஏக்கர்)',
    calc_button: 'கணக்கிடு',
    calc_reset: 'மீட்டமை',
    calc_total_cost: 'மொத்த செலவு',
    calc_total_revenue: 'மொத்த வருமானம்',
    calc_net_profit: 'நிகர லாபம்',
    calc_profit_msg: 'ஒரு ஏக்கருக்கு {amount} லாபம் கிடைக்கும்',
    calc_loss_msg: 'ஒரு ஏக்கருக்கு {amount} நஷ்டம் ஏற்படலாம்',
    calc_error: 'கணக்கிடுவதில் தோல்வி.',
    nearby_title: 'அருகிலுள்ள சேவைகள்',
    nearby_button: 'அருகிலுள்ள சேவைகளைக் கண்டுபிடி',
    nearby_locating: 'இடம் கண்டறியப்படுகிறது...',
    nearby_error_location: 'இடத்தைப் பெற முடியவில்லை',
    nearby_error_permission: 'அனுமதி மறுக்கப்பட்டது அல்லது கிடைக்கவில்லை',
    nearby_error_load: 'சேவைகளை ஏற்ற முடியவில்லை',
    nearby_no_results: 'அருகில் சேவைகள் எதுவும் இல்லை',
    expert_name: 'நிபுணர்',
    expert_greeting: 'வணக்கம், நான் நிபுணர். பயிர்கள், விலைகள் அல்லது இந்த பயன்பாட்டைப் பற்றி எதையும் கேளுங்கள்.',
    expert_placeholder: 'நிபுணரிடம் கேளுங்கள்...',
    expert_send: 'அனுப்பு',
    expert_thinking: 'சிந்திக்கிறேன்...',
    expert_error: 'பிழை: இப்போது பதிலளிக்க முடியவில்லை.',
    expert_error_ask: 'மன்னிக்கவும், பதிலைக் கண்டுபிடிக்க முடியவில்லை.',
  },
};

export function I18nProvider({ children }) {
  const [lang, setLang] = useState(() => localStorage.getItem('lang') || 'en');
  useEffect(() => { localStorage.setItem('lang', lang); }, [lang]);

  const t = useMemo(() => {
    const dict = DICTS[lang] || DICTS.en;
    return (key) => dict[key] || DICTS.en[key] || key;
  }, [lang]);

  const value = useMemo(() => ({ t, lang, setLang }), [t, lang]);
  return <I18nContext.Provider value={value}>{children}</I18nContext.Provider>;
}

export function useI18n() {
  return useContext(I18nContext);
}


